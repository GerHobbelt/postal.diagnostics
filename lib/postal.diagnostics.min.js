/*
 postal.diagnostics
 Author: Jim Cowart (http://freshbrewedcode.com/jimcowart)
 License: Dual licensed MIT (http://www.opensource.org/licenses/mit-license) & GPL (http://www.opensource.org/licenses/gpl-license)
 Version 0.7.0
 */
(function(e,t){typeof module=="object"&&module.exports?module.exports=function(e,n){return t(e,n)}:typeof define=="function"&&define.amd?define(["underscore","postal"],function(n,r){return t(r,n,e)}):t(e._,e.postal,e)})(typeof window!="undefined"?window:this,function(e,t,n,r){t.diagnostics=t.diagnostics||{};var i=function(n,r){var i=this;r=r||{},r.writer=r.writer||function(e){console.log(e)},r.serialize&&(this.serialize=r.serialize),i.filters=r.filters||[],i.active=r.hasOwnProperty("active")?r.active:!0,i.removeWireTap=t.addWireTap(function(t,n){if(!i.active)return;if(!i.filters.length||e.any(i.filters,function(e){return i.applyFilter(e,n)}))try{r.writer(i.serialize(n))}catch(s){r.writer("Unable to serialize envelope: "+s)}}),t.diagnostics[n]&&t.diagnostics[n].removeWireTap(),t.diagnostics[n]=i};i.prototype.applyFilter=function(t,n){var r=0,i=0;return e.each(t,function(t,s){n[s]&&(i++,e.isRegExp(t)&&t.test(n[s])?r++:e.isObject(n[s])&&!e.isArray(n[s])?this.applyFilter(t,n[s])&&r++:e.isEqual(n[s],t)&&r++)},this),r===i},i.prototype.clearFilters=function(){this.filters=[]},i.prototype.removeFilter=function(t){this.filters=e.filter(this.filters,function(n){return!e.isEqual(n,t)})},i.prototype.addFilter=function(t){e.isArray(t)||(t=[t]),e.each(t,function(t){(this.filters.length===0||!e.any(this.filters,function(n){return e.isEqual(n,t)}))&&this.filters.push(t)},this)},i.prototype.serialize=function(e){if(typeof JSON=="undefined")throw new Error("This browser or environment does not provide JSON support");return JSON.stringify(e,null,4)},t.diagnostics.DiagnosticsWireTap=i})